{% extends 'base/layout.html' %}
{% load helpers %}

{% block title %}Plugin Catalog{% endblock %}

{% block head %}
<style>
    /* HTMX loading indicator */
    .htmx-indicator {
        display: none;
    }
    .htmx-request .htmx-indicator {
        display: inline-block !important;
    }
    .htmx-request.htmx-indicator {
        display: inline-block !important;
    }
</style>
{% endblock %}

{% block tabs %}
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" href="{% url 'plugins:netbox_catalog:catalog_list' %}">Browse</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'plugins:netbox_catalog:installationlog_list' %}">History</a>
    </li>
</ul>
{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="mdi mdi-puzzle"></i> Plugin Catalog
                </h5>
                <div>
                    <span class="text-muted me-3">{{ total_count }} plugins</span>
                    <form method="post" action="{% url 'plugins:netbox_catalog:refresh_cache' %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-secondary">
                            <i class="mdi mdi-refresh"></i> Refresh
                        </button>
                    </form>
                </div>
            </div>
            <div class="card-body">
                <!-- Filters -->
                <form method="get" class="row g-3 mb-4"
                      hx-get="{% url 'plugins:netbox_catalog:catalog_list' %}"
                      hx-target="#plugin-grid"
                      hx-swap="innerHTML"
                      hx-indicator="#filter-loading">
                    <div class="col-md-3">
                        {{ filter_form.q }}
                    </div>
                    <div class="col-md-2">
                        {{ filter_form.category }}
                    </div>
                    <div class="col-md-2">
                        {{ filter_form.certification }}
                    </div>
                    <div class="col-md-2">
                        {{ filter_form.status }}
                    </div>
                    <div class="col-md-2">
                        {{ filter_form.compatibility }}
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary w-100">
                            <span class="htmx-indicator spinner-border spinner-border-sm d-none" id="filter-loading" role="status"></span>
                            Filter
                        </button>
                    </div>
                </form>

                <!-- Plugin Grid -->
                <div class="row"
                     id="plugin-grid"
                     hx-get="{% url 'plugins:netbox_catalog:catalog_list' %}{% if request.GET.urlencode %}?{{ request.GET.urlencode }}{% endif %}"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                    <!-- Loading spinner shown during initial load -->
                    <div class="col-12">
                        <div class="d-flex flex-column align-items-center justify-content-center py-5">
                            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mb-1">Loading {{ total_count }} plugins from PyPI...</p>
                            <p class="text-muted small">This may take a moment on first load</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
